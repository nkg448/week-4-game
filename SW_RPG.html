<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>jQuery Calculator</title>

  <!-- Added link to the jQuery Library -->
  <!--<script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>-->
  <script src="https://code.jquery.com/jquery.js"></script>
   
  <!-- Added a link to Bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  

</head>
<body>

  <div class="jumbotron">
    <h1 class="text-center">Star Wars RP*G!</h1>
    <h3 class="text-center">Now with 100% more BootStrap!</h3>
  </div>

  <div class="container">
    <div class="row">
      
      <!-- Character Selection Panel -->
      <div class="col-md-8">
      <div class="row">
      <div class="col-md-12">
        <div class="panel panel-info">
          <div class="panel-heading"><h3 class="panel-title">Choose your fighter: </h3></div>
          <div class="panel-body" id="fighters">
            <!-- This will be filled by JavaScript!-->
          </div>
        </div>
      </div></div>
      <div class="row">
        <div class="col-md-12">
        <div class="panel panel-info">
          <div class="panel-heading"><h3 class="panel-title">Choose your opponent: </h3></div>
          <div class="panel-body" id="enemies">
            <!-- This will be filled by JavaScript!-->
          </div>
          </div>
        </div>
      </div>
      </div>
      <!--This is the arena -->
      <div class="col-md-4">
        <div class="panel panel-primary">
          <div class="panel-heading"> <h3 class="panel-title">The Arena</h3> </div>
           <div class="panel-body" id="arena">
            <!-- This will be filled by JavaScript!-->
          </div>
        </div>
        </div>
    </div>

  </div>

  <script type="text/javascript">

    $(document).ready(function() {
      
      function drawScreen(allChars) {
       // $("#fighters").empty();
       // $("#arena").empty();
       // $("#enemies").empty();
        for(i=0;i<allChars.length;i++)
        {
          if(allChars[i].isFighter){
            if(allChars[i].isActive){
              var activeFighter=i;
              allChars[i].panel.attr("class","panel panel-success active col-md-6");
              }
            else{
              allChars[i].panel.attr("class","panel panel-success fighter col-md-3");
              $("#fighters").append(allChars[i].panel);
              console.log(allChars[i].id);
            }
          }
          if(allChars[i].isEnemy){
            if(allChars[i].isActive){
              var activeEnemy=i;
              allChars[i].panel.attr("class","panel panel-danger active col-md-6");
            } 
            else{  
              allChars[i].panel.attr("class","panel panel-danger enemy col-md-3");
              $("#enemies").append(allChars[i].panel);
            }
          }
        }
        if(activeFighter) $("#arena").append(allChars[activeFighter].panel);
        if(activeEnemy) $("#arena").append(allChars[activeEnemy].panel);

        if(activeFighter && activeEnemy)
        {
          $("#arena").append(gamePanel());
        }

      };

      function gamePanel(){
        var buttonDiv = $("<div>");
        buttonDiv.addClass("col-md-12");
        var button = $("<button type=\"button\" class=\"btn btn-warning btn-block\">Attack!</button>");
        buttonDiv.append(button);
        return buttonDiv;



      }

      function makePanel(someChar){
        //declare elements of panel
        var panel = $("<div>");
        var panelHeading = $("<div>");
        var panelBody = $("<div>");
        var panelFooter= $("<div>");
        var img = $("<img>");

        //set classes, fill information/images
        //header
        panelHeading.addClass("panel-heading text-center");
        panelHeading.html(someChar.name);
        //body
        panelBody.addClass("panel-body");
        img.attr("src",someChar.image);
        img.addClass("img-responsive");
        panelBody.append(img);
        //footer
        panelFooter.addClass("panel-footer");
        panelFooter.html("HP: " + someChar.currentHP + "<br>Damage: " + someChar.Damage);
        
        //put it all together
        panel.append(panelHeading);
        panel.append(panelBody);
        panel.append(panelFooter);
        panel.attr("id",someChar.id);
        someChar.panel = panel;
      };

      var fighterChosen=false;
      var enemyChosen=false;

      var charDarthSid = {
        name: "Darth Sidious",
        id:"darthsid",
        initialHP: 100,
        currentHP: 100,
        initialDamage : 10,
        Damage: 10,
        isFighter: true,
        isEnemy: false,
        isActive: false,
        isLocked: false,
        image: "http://placehold.it/200x200"
        //panel: ""

      };

      var charDarthMaul = {
        name: "Darth Maul",
        id: "darthmaul",
        initialHP: 0,
        currentHP: 100,
        initialDamage : 10,
        Damage: 10,
        isFighter: true,
        isEnemy: false,
        isActive: false,
        isLocked: false,
        image: "http://placehold.it/200x200"
        //panel:""
      };

      var charLukeSky = {
        name: "Luke Skywalker",
        id: "lukesky",
        initialHP: 0,
        currentHP: 0,
        initialDamage : 10,
        Damage: 0,
        isFighter: true,
        isEnemy: false,
        isActive: false,
        isLocked: false,
        image: "http://placehold.it/200x200"
        //panel:""
      };

      var charObi = {
        name: "Obi Wan Kenobi",
        id: "obi",
        initialHP: 0,
        currentHP: 0,
        initialDamage : 10,
        Damage: 0,
        isFighter: true,
        isEnemy: false,
        isActive: false,
        isLocked: false,
        image: "http://placehold.it/200x200"
        //panel:""
      };

      makePanel(charLukeSky);
      makePanel(charDarthMaul);
      makePanel(charDarthSid);
      makePanel(charObi);

      //NOTE: For some reason, whichever obj is first breaks the redraw process, putting in a dummy value fixes it. 

      var allChars=[0,charLukeSky,charDarthSid,charDarthMaul,charObi];
      drawScreen(allChars);

      $(document).on("click", ".fighter", function() {
        for(i=0;i<allChars.length;i++){
          if(allChars[i].id===this.id){
            allChars[i].isActive=true;
            fighterChosen=true;
          } 
          else{
            allChars[i].isFighter=false;
            allChars[i].isEnemy=true;
          }
        }

        drawScreen(allChars);
        console.log(this);

      });

      $(document).on("click", ".enemy", function() {
        for(i=0;i<allChars.length;i++){
          if(allChars[i].id===this.id && !allChars[i].isLocked ){
            allChars[i].isActive=true;
            enemyChosen=true;

          } 
          else{
            allChars[i].isLocked=true;
          }
        }
                
        drawScreen(allChars);
        console.log(this);

      });
  
    });

</script>

</body>
</html>
